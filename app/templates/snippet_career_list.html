{% extends 'base.html' %}

{% block title %}Êô∫ËÉΩËÅå‰ΩçÊé®Ëçê{% endblock %}

{% block content %}
<!-- Êé®ËçêËÅå‰ΩçÂå∫Âüü -->
{% if recommended_jobs %}
<div class="recommended-section">
    <div class="page-header">
        <div class="icon">üéØ</div>
        <h1 class="page-title">‰∏∫ÊÇ®Êé®Ëçê</h1>
    </div>
    
    {% if user_skills %}
    <div class="skills-showcase">
        <h3>ÊÇ®ÁöÑÊäÄËÉΩÂåπÈÖç</h3>
        <div class="skills-tags">
            {% for skill in user_skills %}
            <span class="skill-tag">{{ skill }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="recommended-jobs-grid">
        {% for rec in recommended_jobs %}
        <div class="job-card recommended">
            <div class="match-badge">{{ rec.match_score }}% ÂåπÈÖç</div>
            <div class="job-image">{{ rec.job.title[0] | upper }}</div>
            <div class="job-info">
                <div class="job-title">
                    <h2>{{ rec.job.title }}</h2>
                    <p class="company-name">{{ rec.job.company_name }}</p>
                </div>
                <div class="job-details">
                    <p><i class="fas fa-map-marker-alt"></i> {{ rec.job.location }}</p>
                    <p><i class="fas fa-money-bill-wave"></i> {{ rec.job.salary }} ÂÖÉ/Êúà</p>
                    <p><i class="fas fa-clock"></i> {{ rec.job.job_type or 'ÂÖ®ËÅå' }}</p>
                </div>
                <div class="job-description">
                    {{ rec.job.description[:150] }}{% if rec.job.description|length > 150 %}...{% endif %}
                </div>
            </div>
            <div class="job-actions">
                <a href="{{ url_for('main.job_detail', job_id=rec.job.id) }}" class="btn-view">Êü•ÁúãËØ¶ÊÉÖ</a>
                <a href="{{ url_for('main.apply', job_id=rec.job.id) }}" class="btn-apply">Á´ãÂç≥Áî≥ËØ∑</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- ÊâÄÊúâËÅå‰ΩçÂå∫Âüü -->
<div class="all-jobs-section">
    <div class="page-header">
        <div class="icon">üíº</div>
        <h1 class="page-title">ÊâÄÊúâÂèØÁî®ËÅå‰Ωç</h1>
    </div>
<style>
    /* Êé®ËçêËÅå‰ΩçÊ†∑Âºè */
    .recommended-section {
        margin-bottom: 40px;
    }
    
    .skills-showcase {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .skills-showcase h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 18px;
    }
    
    .skills-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .skill-tag {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .recommended-jobs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .job-card.recommended {
        position: relative;
        border: 2px solid #e1e8ed;
        border-radius: 12px;
        padding: 20px;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .job-card.recommended:hover {
        border-color: #3498db;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .job-card.recommended::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .match-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 700;
    }
    
    .job-info {
        flex: 1;
        margin-left: 20px;
    }
    
    .company-name {
        color: #3498db;
        font-weight: 600;
        margin: 5px 0;
    }
    
    .job-description {
        color: #2c3e50;
        line-height: 1.5;
        margin: 10px 0;
        font-size: 14px;
    }
    
    .job-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .btn-view,
    .btn-apply {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-decoration: none;
        text-align: center;
    }
    
    .btn-apply {
        background: #27ae60;
        color: white;
    }
    
    .btn-apply:hover {
        background: #229954;
    }
    
    .btn-view {
        background: #ecf0f1;
        color: #2c3e50;
    }
    
    .btn-view:hover {
        background: #d5dbdb;
    }
    
    /* Light Mode */
    .page-header {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .page-header .icon {
        font-size: 24px;
        color: #ffaf00;
        margin-right: 10px;
    }

    .page-header .page-title {
        font-size: 28px;
        color: #333;
        margin: 0;
    }

    /* Dark Mode */
    body.dark .page-header {
        background: #444;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    body.dark .page-header .page-title {
        color: #fff;
    }

    .header-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: space-between;
    }

    .header-bar input[type="text"], .header-bar select {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .job-card {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
    }

    body.dark .job-card {
        background: #333;
    }

    .job-image {
        background-color: #ffaf00;
        color: #fff;
        font-size: 24px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        margin-right: 20px;
    }

    .job-title h2 {
        margin: 0;
        font-size: 24px;
    }

    .job-details {
        display: flex;
        align-items: center;
    }

    .job-details p {
        margin: 0 10px;
        font-size: 16px;
        display: flex;
        align-items: center;
    }

    .job-details .icon {
        margin-right: 5px;
    }

    .job-actions .edit-button {
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        text-decoration: none;
    }

    .job-details .location-icon, .job-details .salary-icon {
        margin-right: 5px;
    }
</style>

<div class="jobs-wrapper">
    <div class="page-header">
        <i class="uil uil-briefcase icon"></i>
        <h1 class="page-title">ÂèØÁî®ËÅå‰Ωç</h1>
    </div>
    <div class="header-bar">
        <input type="text" placeholder="ÊåâËÅå‰ΩçÂêçÁß∞ÊêúÁ¥¢..." class="search-input" id="search-by-name">
        <input type="text" placeholder="ÊåâËñ™ËµÑÊêúÁ¥¢..." class="search-input" id="search-by-salary">
        <select id="search-by-location" class="search-input">
            <option value="" disabled selected>ÈÄâÊã©Âú∞ÁÇπ</option>
            <!-- Options will be populated by JavaScript -->
        </select>
    </div>
    <div class="jobs-list" id="jobs-list">
        {% for job in jobs %}
        <div class="job-card" data-title="{{ job.title | lower }}" data-salary="{{ job.salary }}" data-location="{{ job.location | lower }}">
            <div class="job-image">
                {{ job.title[0] | upper }}
            </div>
            <div class="job-title">
                <h2>{{ job.title }}</h2>
            </div>
            <div class="job-details">
                <p><i class="uil uil-location-point location-icon"></i>{{ job.location }}</p>
                <p><i class="uil uil-money-bill salary-icon"></i>{{ job.salary }}</p>
            </div>
            <div class="job-actions">
                <a href="{{ url_for('main.job_detail', job_id=job.id) }}" class="edit-button">Êü•ÁúãÊõ¥Â§ö</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchByName = document.getElementById('search-by-name');
        const searchBySalary = document.getElementById('search-by-salary');
        const searchByLocation = document.getElementById('search-by-location');
        const jobsList = document.getElementById('jobs-list');
        const jobCards = jobsList.getElementsByClassName('job-card');

        // Populate location dropdown with countries
        fetch('https://restcountries.com/v3.1/all')
            .then(response => response.json())
            .then(data => {
                data.sort((a, b) => a.name.common.localeCompare(b.name.common));
                data.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.name.common.toLowerCase();
                    option.textContent = country.name.common;
                    searchByLocation.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching country data:', error));

        function filterJobs() {
            const nameQuery = searchByName.value.toLowerCase();
            const salaryQuery = searchBySalary.value;
            const locationQuery = searchByLocation.value.toLowerCase();

            Array.from(jobCards).forEach(card => {
                const title = card.getAttribute('data-title');
                const salary = card.getAttribute('data-salary');
                const location = card.getAttribute('data-location');

                const matchesName = title.includes(nameQuery);
                const matchesSalary = salary.includes(salaryQuery);
                const matchesLocation = location.includes(locationQuery) || locationQuery === '';

                if (matchesName && matchesSalary && matchesLocation) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        searchByName.addEventListener('input', filterJobs);
        searchBySalary.addEventListener('input', filterJobs);
        searchByLocation.addEventListener('change', filterJobs);
    });
</script>
{% endblock %}
