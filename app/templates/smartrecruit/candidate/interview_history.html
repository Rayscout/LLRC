<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>面试历史 - AI虚拟面试</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='ios_unified_style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="ios-nav">
        <div class="ios-nav-container">
            <div class="ios-nav-brand">
                <i class="fas fa-microphone"></i>
                <span>AI虚拟面试</span>
            </div>
            
            <h1 class="ios-nav-title">面试历史</h1>
            
            <div class="ios-nav-actions">
                <button class="ios-nav-button" onclick="location.href='{{ url_for('smartrecruit.candidate.interview.interview_dashboard') }}'">
                    <i class="fas fa-home"></i>
                    <span>面试中心</span>
                </button>
                
                <button class="ios-nav-button" onclick="location.href='{{ url_for('smartrecruit.candidate.home') }}'">
                    <i class="fas fa-home"></i>
                    <span>返回首页</span>
                </button>
                
                <button class="theme-toggle" id="themeToggle" title="切换主题">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="ios-main">
        <!-- 统计概览 -->
        <section class="ios-section">
            <div class="ios-container">
                <div class="ios-card ios-fade-in">
                    <h2 class="ios-title">面试统计</h2>
                    
                    <div class="ios-grid ios-grid-4">
                        <div class="ios-stat-card">
                            <i class="fas fa-calendar-check" style="font-size: 2rem; color: var(--ios-blue);"></i>
                            <div class="ios-stat-content">
                                <span class="ios-stat-number">{{ sessions|length }}</span>
                                <span class="ios-stat-label">总面试次数</span>
                            </div>
                        </div>
                        
                        <div class="ios-stat-card">
                            <i class="fas fa-trophy" style="font-size: 2rem; color: var(--ios-orange);"></i>
                            <div class="ios-stat-content">
                                <span class="ios-stat-number">
                                    {% if sessions %}
                                        {{ (sessions|map(attribute='total_score')|sum / sessions|length)|round(1) }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </span>
                                <span class="ios-stat-label">平均分数</span>
                            </div>
                        </div>
                        
                        <div class="ios-stat-card">
                            <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--ios-green);"></i>
                            <div class="ios-stat-content">
                                <span class="ios-stat-number">
                                    {% if sessions %}
                                        {{ sessions|map(attribute='total_score')|max }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </span>
                                <span class="ios-stat-label">最高分数</span>
                            </div>
                        </div>
                        
                        <div class="ios-stat-card">
                            <i class="fas fa-building" style="font-size: 2rem; color: var(--ios-purple);"></i>
                            <div class="ios-stat-content">
                                <span class="ios-stat-number">
                                    {% if sessions %}
                                        {{ sessions|map(attribute='job_id')|unique|list|length }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </span>
                                <span class="ios-stat-label">面试公司数</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 面试历史列表 -->
        <section class="ios-section">
            <div class="ios-container">
                <h2 class="ios-section-title">面试记录</h2>
                
                {% if sessions %}
                    <div class="ios-history-list">
                        {% for session in sessions %}
                        <div class="ios-card ios-fade-in">
                            <div class="ios-card-header">
                                <div class="ios-card-title">
                                    <h3>{{ session.job_title or '未知职位' }}</h3>
                                    <span class="ios-badge ios-badge-primary">{{ session.company_name or '未知公司' }}</span>
                                </div>
                                <div class="ios-card-meta">
                                    <span class="ios-score">{{ session.total_score }}/10</span>
                                    <span class="ios-date">{{ session.end_time.strftime('%Y-%m-%d %H:%M') }}</span>
                                </div>
                            </div>
                            
                            <div class="ios-card-content">
                                <div class="ios-session-summary">
                                    <div class="ios-summary-item">
                                        <i class="fas fa-question-circle"></i>
                                        <span>回答了 {{ session.answers|length }} 个问题</span>
                                    </div>
                                    <div class="ios-summary-item">
                                        <i class="fas fa-clock"></i>
                                        <span>面试时长: {{ ((session.end_time - session.start_time).total_seconds() / 60)|round(1) }} 分钟</span>
                                    </div>
                                    <div class="ios-summary-item">
                                        <i class="fas fa-star"></i>
                                        <span>表现评级: 
                                            {% if session.total_score >= 8 %}
                                                <span class="ios-badge ios-badge-success">优秀</span>
                                            {% elif session.total_score >= 6 %}
                                                <span class="ios-badge ios-badge-warning">良好</span>
                                            {% else %}
                                                <span class="ios-badge ios-badge-danger">需改进</span>
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                
                                {% if session.answers %}
                                <div class="ios-answers-preview">
                                    <h4>问题预览：</h4>
                                    <ul class="ios-questions-list">
                                        {% for answer in session.answers[:3] %}
                                        <li>{{ answer.question[:50] }}...</li>
                                        {% endfor %}
                                        {% if session.answers|length > 3 %}
                                        <li class="ios-more">... 还有 {{ session.answers|length - 3 }} 个问题</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="ios-card-actions">
                                <button class="ios-button ios-button-secondary" onclick="location.href='{{ url_for('smartrecruit.candidate.interview.interview_result', session_id=session.session_id) }}'">
                                    <i class="fas fa-eye"></i>
                                    查看详情
                                </button>
                                
                                <button class="ios-button" onclick="location.href='{{ url_for('smartrecruit.candidate.interview.interview_dashboard') }}'">
                                    <i class="fas fa-redo"></i>
                                    再次面试
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="ios-card ios-fade-in">
                        <div class="ios-empty-state">
                            <i class="fas fa-history" style="font-size: 4rem; color: var(--ios-gray); margin-bottom: 2rem;"></i>
                            <h3>暂无面试记录</h3>
                            <p class="ios-text-muted">您还没有完成任何AI虚拟面试，开始您的第一次面试吧！</p>
                            <button class="ios-button ios-button-primary" onclick="location.href='{{ url_for('smartrecruit.candidate.interview.interview_dashboard') }}'">
                                <i class="fas fa-play"></i>
                                开始面试
                            </button>
                        </div>
                    </div>
                {% endif %}
            </div>
        </section>

        <!-- 进步趋势 -->
        {% if sessions|length > 1 %}
        <section class="ios-section">
            <div class="ios-container">
                <h2 class="ios-section-title">进步趋势</h2>
                
                <div class="ios-card ios-fade-in">
                    <div class="ios-card-content">
                        <div class="ios-trend-analysis">
                            <div class="ios-trend-item">
                                <i class="fas fa-arrow-up" style="color: var(--ios-green);"></i>
                                <span>您的面试表现正在稳步提升</span>
                            </div>
                            <div class="ios-trend-item">
                                <i class="fas fa-chart-line" style="color: var(--ios-blue);"></i>
                                <span>建议继续练习以保持技能水平</span>
                            </div>
                            <div class="ios-trend-item">
                                <i class="fas fa-lightbulb" style="color: var(--ios-yellow);"></i>
                                <span>关注AI反馈中的改进建议</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
    </main>

    <script>
        // 主题切换
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // 检查本地存储的主题设置
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            const isDark = body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });

        // 页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.ios-fade-in');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            cards.forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>
