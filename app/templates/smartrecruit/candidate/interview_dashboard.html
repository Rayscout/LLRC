{% extends "smartrecruit/candidate/base_ios.html" %}

{% block title %}AIé¢è¯•è®­ç»ƒ{% endblock %}

{% block content %}
<section class="section" id="interview-dashboard">
    <div style="width: 100%; max-width: 1200px;">
        <div class="card animate-fade-in-up">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 2.5rem; margin-bottom: 15px; background: linear-gradient(135deg, var(--accent-color), var(--accent-hover)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    ğŸ¤ AIé¢è¯•è®­ç»ƒ
                </h1>
                <p style="font-size: 1.1rem; color: var(--text-secondary);">ä½“éªŒAIé©±åŠ¨çš„æ™ºèƒ½é¢è¯•ï¼Œæå‡æ‚¨çš„é¢è¯•æŠ€å·§å’Œè¡¨ç°</p>
            </div>
                    
                    <div class="ios-grid ios-grid-3 mt-xl">
                        <div class="ios-card">
                            <i class="fas fa-robot" style="font-size: 3rem; color: var(--ios-blue); margin-bottom: 1rem;"></i>
                            <h3>AIæ™ºèƒ½é—®ç­”</h3>
                            <p class="ios-metric-value">ä¸ªæ€§åŒ–é—®é¢˜</p>
                            <p class="ios-metric-label">åŸºäºæ‚¨çš„ç®€å†å’ŒèŒä½è¦æ±‚</p>
                        </div>
                        
                        <div class="ios-card">
                            <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--ios-green); margin-bottom: 1rem;"></i>
                            <h3>å®æ—¶åé¦ˆ</h3>
                            <p class="ios-metric-value">å³æ—¶è¯„åˆ†</p>
                            <p class="ios-metric-label">æ¯é“é¢˜éƒ½æœ‰è¯¦ç»†åé¦ˆ</p>
                        </div>
                        
                        <div class="ios-card">
                            <i class="fas fa-trophy" style="font-size: 3rem; color: var(--ios-orange); margin-bottom: 1rem;"></i>
                            <h3>æŠ€èƒ½æå‡</h3>
                            <p class="ios-metric-value">æŒç»­æ”¹è¿›</p>
                            <p class="ios-metric-label">é€šè¿‡ç»ƒä¹ æå‡é¢è¯•æŠ€å·§</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¯é¢è¯•èŒä½ -->
        <section class="ios-section">
            <div class="ios-container">
                <h2 class="ios-section-title">å¯è¿›è¡Œé¢è¯•çš„èŒä½</h2>
                
                {% if available_jobs %}
                    <div class="ios-grid ios-grid-2">
                        {% for job_data in available_jobs %}
                        <div class="ios-card ios-fade-in">
                            <div class="ios-card-header">
                                <h3>{{ job_data.job.title }}</h3>
                                <span class="ios-badge ios-badge-primary">{{ job_data.job.company }}</span>
                            </div>
                            
                            <div class="ios-card-content">
                                <p class="ios-text-muted">{{ job_data.job.location }} â€¢ {{ job_data.job.job_type }}</p>
                                <p class="ios-text">{{ job_data.job.description[:200] }}...</p>
                                
                                <div class="ios-metrics">
                                    <div class="ios-metric">
                                        <span class="ios-metric-label">ç”³è¯·çŠ¶æ€</span>
                                        <span class="ios-metric-value">{{ job_data.application.status }}</span>
                                    </div>
                                    <div class="ios-metric">
                                        <span class="ios-metric-label">ç”³è¯·æ—¶é—´</span>
                                        <span class="ios-metric-value">{{ job_data.application.created_at.strftime('%Y-%m-%d') }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ios-card-actions">
                                <button class="ios-button ios-button-primary" onclick="startInterview({{ job_data.job.id }})">
                                    <i class="fas fa-play"></i>
                                    å¼€å§‹é¢è¯•
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="ios-card ios-fade-in">
                        <div class="ios-empty-state">
                            <i class="fas fa-inbox" style="font-size: 4rem; color: var(--ios-gray); margin-bottom: 2rem;"></i>
                            <h3>æš‚æ— å¯é¢è¯•çš„èŒä½</h3>
                            <p class="ios-text-muted">æ‚¨éœ€è¦å…ˆç”³è¯·èŒä½æ‰èƒ½è¿›è¡ŒAIè™šæ‹Ÿé¢è¯•</p>
                            <button class="ios-button" onclick="location.href='{{ url_for('smartrecruit.candidate.jobs.jobs_list') }}'">
                                <i class="fas fa-search"></i>
                                æµè§ˆèŒä½
                            </button>
                        </div>
                    </div>
                {% endif %}
            </div>
        </section>

        <!-- é¢è¯•æŠ€å·§æç¤º -->
        <section class="ios-section">
            <div class="ios-container">
                <h2 class="ios-section-title">é¢è¯•æŠ€å·§æç¤º</h2>
                
                <div class="ios-grid ios-grid-3">
                    <div class="ios-card ios-fade-in">
                        <i class="fas fa-lightbulb" style="font-size: 2rem; color: var(--ios-yellow); margin-bottom: 1rem;"></i>
                        <h3>å‡†å¤‡å……åˆ†</h3>
                        <p>æå‰äº†è§£å…¬å¸å’ŒèŒä½ä¿¡æ¯ï¼Œå‡†å¤‡ç›¸å…³çš„é¡¹ç›®ç»éªŒå’ŒæŠ€èƒ½è¯´æ˜</p>
                    </div>
                    
                    <div class="ios-card ios-fade-in">
                        <i class="fas fa-comments" style="font-size: 2rem; color: var(--ios-blue); margin-bottom: 1rem;"></i>
                        <h3>æ¸…æ™°è¡¨è¾¾</h3>
                        <p>ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€å›ç­”é—®é¢˜ï¼Œçªå‡ºè‡ªå·±çš„æ ¸å¿ƒèƒ½åŠ›å’Œæˆå°±</p>
                    </div>
                    
                    <div class="ios-card ios-fade-in">
                        <i class="fas fa-chart-bar" style="font-size: 2rem; color: var(--ios-green); margin-bottom: 1rem;"></i>
                        <h3>é‡åŒ–æˆæœ</h3>
                        <p>ç”¨å…·ä½“çš„æ•°æ®å’Œæˆæœæ¥æ”¯æ’‘ä½ çš„å›ç­”ï¼Œè®©é¢è¯•å®˜çœ‹åˆ°ä½ çš„ä»·å€¼</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¢è¯•å¼€å§‹æ¨¡æ€æ¡† -->
    <div id="interviewModal" class="ios-modal">
        <div class="ios-modal-content">
            <div class="ios-modal-header">
                <h3>å‡†å¤‡å¼€å§‹é¢è¯•</h3>
                <button class="ios-modal-close" onclick="closeInterviewModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ios-modal-body">
                <div id="interviewInfo">
                    <p>é¢è¯•å³å°†å¼€å§‹ï¼Œè¯·ç¡®ä¿ï¼š</p>
                    <ul>
                        <li>ç¯å¢ƒå®‰é™ï¼Œæ— å¹²æ‰°</li>
                        <li>ç½‘ç»œè¿æ¥ç¨³å®š</li>
                        <li>å‡†å¤‡å¥½å›ç­”æŠ€æœ¯é—®é¢˜</li>
                    </ul>
                </div>
                
                <div id="interviewLoading" style="display: none;">
                    <div class="ios-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>æ­£åœ¨ç”Ÿæˆé¢è¯•é—®é¢˜...</p>
                    </div>
                </div>
            </div>
            
            <div class="ios-modal-footer">
                <button class="ios-button ios-button-secondary" onclick="closeInterviewModal()">å–æ¶ˆ</button>
                <button class="ios-button ios-button-primary" id="confirmStartBtn" onclick="confirmStartInterview()">
                    ç¡®è®¤å¼€å§‹
                </button>
            </div>
        </div>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            const isDark = body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });

        // é¢è¯•ç›¸å…³å˜é‡
        let currentJobId = null;
        
        // å¼€å§‹é¢è¯•
        function startInterview(jobId) {
            currentJobId = jobId;
            document.getElementById('interviewModal').style.display = 'flex';
        }
        
        // å…³é—­é¢è¯•æ¨¡æ€æ¡†
        function closeInterviewModal() {
            document.getElementById('interviewModal').style.display = 'none';
            document.getElementById('interviewInfo').style.display = 'block';
            document.getElementById('interviewLoading').style.display = 'none';
            document.getElementById('confirmStartBtn').disabled = false;
        }
        
        // ç¡®è®¤å¼€å§‹é¢è¯•
        function confirmStartInterview() {
            if (!currentJobId) return;
            
            document.getElementById('interviewInfo').style.display = 'none';
            document.getElementById('interviewLoading').style.display = 'block';
            document.getElementById('confirmStartBtn').disabled = true;
            
            // å‘é€å¼€å§‹é¢è¯•è¯·æ±‚
            fetch(`/smartrecruit/candidate/interview/start/${currentJobId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // è·³è½¬åˆ°é¢è¯•ä¼šè¯é¡µé¢
                    window.location.href = `/smartrecruit/candidate/interview/session/${data.session_id}`;
                } else {
                    alert('å¼€å§‹é¢è¯•å¤±è´¥ï¼š' + data.error);
                    closeInterviewModal();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                closeInterviewModal();
            });
        }
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.ios-fade-in');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            cards.forEach(card => {
                observer.observe(card);
            });
        });
    </script>
{% endblock %}
</body>
</html>
