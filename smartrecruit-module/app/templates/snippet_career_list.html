{% extends 'base.html' %}

{% block title %}可用职位{% endblock %}

{% block content %}
<style>
    /* Light Mode */
    .page-header {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .page-header .icon {
        font-size: 24px;
        color: #ffaf00;
        margin-right: 10px;
    }

    .page-header .page-title {
        font-size: 28px;
        color: #333;
        margin: 0;
    }

    /* Dark Mode */
    body.dark .page-header {
        background: #444;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    body.dark .page-title {
        color: #fff;
    }

    .header-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: space-between;
    }

    .header-bar input[type="text"], .header-bar select {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .job-card {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
    }

    body.dark .job-card {
        background: #333;
    }

    .job-image {
        background-color: #ffaf00;
        color: #fff;
        font-size: 24px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        margin-right: 20px;
    }

    .job-title h2 {
        margin: 0;
        font-size: 24px;
    }

    .job-details {
        display: flex;
        align-items: center;
    }

    .job-details p {
        margin: 0 10px;
        font-size: 16px;
        display: flex;
        align-items: center;
    }

    .job-details .icon {
        margin-right: 5px;
    }

    .job-actions .edit-button {
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        text-decoration: none;
    }

    .job-details .location-icon, .job-details .salary-icon {
        margin-right: 5px;
    }
</style>

<div class="jobs-wrapper">
    <div class="page-header">
        <i class="uil uil-briefcase icon"></i>
        <h1 class="page-title">可用职位</h1>
    </div>
    <div class="header-bar">
        <input type="text" placeholder="按职位名称搜索..." class="search-input" id="search-by-name">
        <input type="text" placeholder="按薪资搜索..." class="search-input" id="search-by-salary">
        <select id="search-by-location" class="search-input">
            <option value="" disabled selected>请选择地点</option>
            <!-- Options will be populated by JavaScript -->
        </select>
    </div>
    <div class="jobs-list" id="jobs-list">
        {% for job in jobs %}
        <div class="job-card" data-title="{{ job.title | lower }}" data-salary="{{ job.salary }}" data-location="{{ job.location | lower }}">
            <div class="job-image">
                {{ job.title[0] | upper }}
            </div>
            <div class="job-info">
                <div class="job-title">
                    <h2>{{ job.title }}</h2>
                    {% if job.department %}
                    <span class="department">{{ job.department }}</span>
                    {% endif %}
                </div>
                <div class="job-meta">
                    <span class="location"><i class="uil uil-map-marker"></i> {{ job.location }}</span>
                    <span class="salary"><i class="uil uil-money-bill"></i> {{ job.salary }}</span>
                    {% if job.job_type %}
                    <span class="job-type"><i class="uil uil-clock"></i> {{ job.job_type }}</span>
                    {% endif %}
                    {% if job.positions_needed %}
                    <span class="positions"><i class="uil uil-users"></i> 招聘{{ job.positions_needed }}人</span>
                    {% endif %}
                </div>
                <div class="job-requirements">
                    {% if job.education_requirement %}
                    <span class="requirement"><i class="uil uil-graduation-cap"></i> {{ job.education_requirement }}</span>
                    {% endif %}
                    {% if job.experience_years %}
                    <span class="requirement"><i class="uil uil-briefcase"></i> {{ job.experience_years }}年经验</span>
                    {% endif %}
                    {% if job.min_age or job.max_age %}
                    <span class="requirement"><i class="uil uil-user"></i> 
                        {% if job.min_age and job.max_age %}
                            {{ job.min_age }}-{{ job.max_age }}岁
                        {% elif job.min_age %}
                            {{ job.min_age }}岁以上
                        {% elif job.max_age %}
                            {{ job.max_age }}岁以下
                        {% endif %}
                    </span>
                    {% endif %}
                </div>
                {% if job.skills_required %}
                <div class="skills">
                    <strong>技能要求：</strong>{{ job.skills_required[:100] }}{% if job.skills_required|length > 100 %}...{% endif %}
                </div>
                {% endif %}
                {% if job.benefits %}
                <div class="benefits">
                    <strong>福利待遇：</strong>{{ job.benefits[:100] }}{% if job.benefits|length > 100 %}...{% endif %}
                </div>
                {% endif %}
                <div class="job-description">
                    {{ job.description[:200] }}{% if job.description|length > 200 %}...{% endif %}
                </div>
                <div class="job-footer">
                    <span class="posted-date"><i class="uil uil-calendar"></i> {{ job.date_posted.strftime('%Y-%m-%d') }}</span>
                    {% if job.application_deadline %}
                    <span class="deadline"><i class="uil uil-clock-eight"></i> 截止：{{ job.application_deadline.strftime('%Y-%m-%d') }}</span>
                    {% endif %}
                    {% if job.contact_email or job.contact_phone %}
                    <span class="contact-info">
                        {% if job.contact_email %}<i class="uil uil-envelope"></i> {{ job.contact_email }}{% endif %}
                        {% if job.contact_phone %}<i class="uil uil-phone"></i> {{ job.contact_phone }}{% endif %}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchByName = document.getElementById('search-by-name');
        const searchBySalary = document.getElementById('search-by-salary');
        const searchByLocation = document.getElementById('search-by-location');
        const jobsList = document.getElementById('jobs-list');
        const jobCards = jobsList.getElementsByClassName('job-card');

        // Populate location dropdown with countries
        fetch('https://restcountries.com/v3.1/all')
            .then(response => response.json())
            .then(data => {
                data.sort((a, b) => a.name.common.localeCompare(b.name.common));
                data.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.name.common.toLowerCase();
                    option.textContent = country.name.common;
                    searchByLocation.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching country data:', error));

        function filterJobs() {
            const nameQuery = searchByName.value.toLowerCase();
            const salaryQuery = searchBySalary.value;
            const locationQuery = searchByLocation.value.toLowerCase();

            Array.from(jobCards).forEach(card => {
                const title = card.getAttribute('data-title');
                const salary = card.getAttribute('data-salary');
                const location = card.getAttribute('data-location');

                const matchesName = title.includes(nameQuery);
                const matchesSalary = salary.includes(salaryQuery);
                const matchesLocation = location.includes(locationQuery) || locationQuery === '';

                if (matchesName && matchesSalary && matchesLocation) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        searchByName.addEventListener('input', filterJobs);
        searchBySalary.addEventListener('input', filterJobs);
        searchByLocation.addEventListener('change', filterJobs);
    });
</script>
{% endblock %}
